{% extends 'class_scheduler_app/base.html' %}
{% block content %}

<div class="container mt-5">

    <h1 class="mb-4 text-center">Teacher Availability Sorting & Assignment</h1>

    <div class="card mb-4 shadow">
        <div class="card-body">
            <h4 class="card-title">How to Use?</h4>
            <p class="text-muted">1. Add Teachers in the Teachers Tab.</p>
            <p class="text-muted">2. Add Sections in the Sections Tab.</p>
            <p class="text-muted">3. Go Back to this webpage and click Sort Teachers (QuickSort).</p>
        </div>
    </div>

    <div class="card mb-4 shadow">
        <div class="card-body">
            <h4 class="card-title">Sort Teachers by Availability</h4>
            <p class="text-muted">Sort in ascending order of available blocks (1â€“11).</p>

            <a id="sortButton" class="btn btn-primary" href="{% url 'generated_timetables' %}">
                Sort Teachers (QuickSort)
            </a>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-body">
            <h4 class="card-title">Teacher List</h4>

            <table class="table table-striped" id="teachersTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Subject</th>
                        <th>Availability (Periods)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in teacher %}
                    <tr data-availability="{{ t.availability|length }}">
                        <td>{{ t.name }}</td>
                        <td>{{ t.get_subject_taught_display }}</td>
                        <td>{{ t.availability }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>
    </div>

</div>

<script>

function quicksort(rows) {
    if (rows.length <= 1) return rows;

    let pivot = rows[0];
    let pivotValue = parseInt(pivot.dataset.availability);

    let left = [];
    let right = [];

    for (let i = 1; i < rows.length; i++) {
        let value = parseInt(rows[i].dataset.availability);
        if (value < pivotValue) left.push(rows[i]);
        else right.push(rows[i]);
    }

    return [...quicksort(left), pivot, ...quicksort(right)];
}

document.getElementById("sortButton").addEventListener("click", function() {
    let tableBody = document.querySelector("#teachersTable tbody");
    let rows = Array.from(tableBody.querySelectorAll("tr"));

    let sorted = quicksort(rows);
    tableBody.innerHTML = "";
    sorted.forEach(r => tableBody.appendChild(r));
});
</script>

{% endblock %}
